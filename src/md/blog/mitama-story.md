---
date: 2020-11-29
title: Mitamaが今の形に落ち着くまでの話
topImage: ./hero/mitama-story.jpg
---

木瓜丸です。

おばあちゃんがブログには自分語りを書いていいと言っていたので、今日はMitamaを作った経緯や今の形になるまでの過程の話を書きます。

特に泣いても飛んでもいないものですが、それなりに骨を折ったので、よかったら見ていってください。

## 木瓜丸、頭良くやりたい
思い立ったのは2019年の3月頃でした。仲間と一緒にWebサービスを運営していたのですが、木瓜丸自身の未熟さもありどうにもチーム上手く回っておらず、チームはIT土方集団と化していました。

そんな時、ちょうど仲間が忙しくなって一時的に離れることになったので、その間に環境を整備することにしました。

最初のうちはSaaSをたくさん導入してなんとかしようとしていましたが、メンバーがあれやこれやを導入するストレスが気になったり、環境をより良くするためのツールの切り替えが面倒な気がしてきました。（後々の話ですが、別の場所でそういう経験をして確信しました）

そこで、**一つのアカウントで様々なアプリを利用できるようにする仕組み**（まあ、SSO？）、**アプリを入れたい時に入れ、気に食わなかったら消せるようにする仕組み**を両方持ったシステムを開発し、ついでに人材管理の機能とか付けたら便利じゃね？と考えました。

## PHPで仕上げる
それから半年位かかり、PHPでの実装が完成しました。
WordPressのようにpluginディレクトリ的なところに所定のインターフェースを実装したもの（アプリ）を置いておくと、それが配信される仕組みです。

しかし、PHPってやっぱりウェブ以外を本格的に書こうとするとキツイんですよね。

たとえば、別プロセスを立ち上げて出力を取るみたいなことをやるにしても、出力を随時HTTPレスポンスにして返すみたいなことができず、レスポンスが完成次第返却しなければ行けないみたいです。（非同期サーバー使ったら行けるのかな？）

ちょっと時間を食う処理があるアプリを組もうとしたら使い物になりませんでした。

## Docker + PHPで作り直す

そこで、ユーザーの認証や組織、人材管理の機能を提供するAPIをPHPで作ってDockerコンテナの中で動かし、ほかのDockerコンテナからそのAPIを叩かせるという仕組みで作り直してみました。

ぶっちゃけめちゃくちゃ良くできたと感じました。

木瓜丸「ヨシ！でけたぞ！Dockerで動くから試しに動かしてみてくれ！」

友「ええで！**ところでDockerって何？**」

木瓜丸「……」

そうです。Dockerをまともに触れる人って実はそんなにたくさんいなかったんです。

**てへぺろ(・ω<)**

## なぜかRustで一から作る
血迷った僕は、Rustで実装し始めました。

シャドーファイルのようなテキストベースのユーザー管理を行う機能と、HTTPサーバーを立ち上げ、オレオレDSLでアプリを配信するというとんでもない設計をしてました。
今考えたらなんでこんなことをしたのかよくわかりません。

ですが、DSLを作っている間に「やっぱりこの設計は駄目だよなー」と感じてきたので、やめました。

しかし、そこでいいことを思いつきました。

## ついにPythonで作る 
**「フレームワークにしちゃえば良いじゃん」**

そう思った僕は、DjangoとFlaskのソースコードを斜め読みしてWebフレームワークを作り、ユーザー管理の機能と組織管理機能（組織構造や人材配置の保存を行う機能）を統合し、人材管理システムっぽいアプリを内蔵させたPythonパッケージをリリースしました。

そんなわけで、今のMitamaになりました。

zennの方に実装する上での技術的な話も書いたので、よかったら読んでください！

https://zenn.dev/boke0/articles/1b12c7905f5cd9

## これからやってみたいこと 
zennにも書いたのですが、「**こんなアプリやサービスがあるから、xxxができる**」という考え方だけでなく、「**xxxがしたいから、こんなサービスが作ればいい**」という考え方がもっとしやすければいいなと思ってます。

まだMitamaにもデータベース周りにアンチパターンが多かったり、モデルをもっと簡単に作れるように改良したいです。

そして、やはりたくさんアプリを作ってリリースしたいです。**これ読んだ人もリリースしてください(^^)**
